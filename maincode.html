<!DOCTYPE html>
<html>
<head>
    <title>CGPA Calculator</title>
</head>
<body>
    <h2>CGPA Calculator</h2>

    <form id="cgpaForm">
        <label>Number of subjects:</label>
        <input type="number" id="numSubjects" min="1" value="3"><br><br>

        <div id="subjects">
            <!-- Subject inputs will be generated by JS -->
        </div>

        <label>Previous CGPA:</label>
        <input type="number" id="prevCGPA" step="0.01"><br><br>

        <label>Total credits of previous semester:</label>
        <input type="number" id="prevCredits" step="0.1"><br><br>

        <button type="button" onclick="calculateCGPA()">Calculate CGPA</button>
    </form>

    <h3 id="result"></h3>

    <script>
        const subjectsDiv = document.getElementById("subjects");
        const numSubjectsInput = document.getElementById("numSubjects");

        function generateSubjects() {
            subjectsDiv.innerHTML = "";
            let n = parseInt(numSubjectsInput.value);
            for(let i=1; i<=n; i++){
                subjectsDiv.innerHTML += `
                    <label>Grade for subject ${i}:</label>
                    <input type="text" id="grade${i}" maxlength="1">
                    <label>Credits:</label>
                    <input type="number" id="credits${i}" step="0.1"><br><br>
                `;
            }
        }

        numSubjectsInput.addEventListener("change", generateSubjects);
        window.onload = generateSubjects;

        function calculateCGPA() {
            let n = parseInt(numSubjectsInput.value);
            let totalWeighted = 0;
            let totalCredits = 0;

            const gradeMap = { "O":10,"A":9,"B":8,"C":7,"D":6,"E":5,"F":0 };

            for(let i=1; i<=n; i++){
                let grade = document.getElementById(`grade${i}`).value.toUpperCase();
                let credits = parseFloat(document.getElementById(`credits${i}`).value);

                if(!(grade in gradeMap)){
                    alert(`Invalid grade for subject ${i}`);
                    return;
                }

                if(grade === "F"){
                    alert("You failed in subject " + i + ". Give the supplementary exam.");
                    return;
                }

                totalWeighted += gradeMap[grade] * credits;
                totalCredits += credits;
            }

            let currentCGPA = totalWeighted / totalCredits;

            let prevCGPA = parseFloat(document.getElementById("prevCGPA").value);
            let prevCredits = parseFloat(document.getElementById("prevCredits").value);

            let cumulativeCGPA = (prevCGPA * prevCredits + currentCGPA * totalCredits) / (prevCredits + totalCredits);

            document.getElementById("result").innerText = 
                `Current Semester CGPA: ${currentCGPA}\nCumulative CGPA: ${cumulativeCGPA}`;
        }
    </script>
</body>
</html>
